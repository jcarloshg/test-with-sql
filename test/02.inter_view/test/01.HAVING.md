# HAVING

**Key Takeaway:**

- Use `WHERE` for columns that exist in the **original table**.
- Use `HAVING` for numbers you created using **math functions** (`SUM`, `COUNT`, etc.).

**The Timeline of a Query:**

1. **The Table:** Contains all 10,000 sales.
2. **`WHERE` (The Pre-Filter):** "Keep only sales from 'Region: US'". (Now we have 5,000 rows).
3. **`GROUP BY` (The Aggregation):** "Sum the sales by City". (The engine does the math. Now we have 50 rows, one per city).
4. **`HAVING` (The Post-Filter):** "Keep only cities where the Sum is > $1,000".

**Code Example:**

```sql
SELECT city, SUM(amount) as total_sales
FROM sales
WHERE category = 'Electronics'    -- 1. FILTER raw rows (Before Math)
GROUP BY city                     -- 2. AGGREGATE (Do the Math)
HAVING SUM(amount) > 10000;       -- 3. FILTER the result (After Math)

```

### 1. What is an aggregation?

- Aggregation is the process of taking **many rows** and collapsing them into **one value**. It is "math" performed on a pile of data.

Common Aggregation functions:

- `COUNT()`: Counts rows.
- `SUM()`: Adds up numbers.
- `AVG()`: Calculates the average.
- `MAX()` / `MIN()`: Finds the highest or lowest value.

### 2. Why `WHERE` is before aggregation?

The `WHERE` clause is the **Gatekeeper**. It looks at the **raw table data** row-by-row _before_ the database engine starts doing any heavy lifting (grouping or math).

**Why it must be first:**

1. **Logic:**
   - You select which data you want to include in your calculation.
   - EJ. If you want to know "Total Sales for 2024," you must throw away the 2023 rows _before_ you start adding numbers.
2. **Performance:**
   - It is much faster to sum 10 rows than 1,000,000 rows.
   - `WHERE` reduces the workload for the aggregation engine by discarding useless data immediately.

---

### 3. Why `HAVING` is after aggregation?

- `HAVING` exists because **you cannot filter by a calculated value that doesn't exist yet.**

- Once the engine finishes the math (Aggregation), it creates a new, temporary list of "Groups." Now, and only now, can you filter based on the results of that math using `HAVING`.
